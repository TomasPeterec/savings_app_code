generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  firebaseUid  String          @id @map("firebase_uid") @db.VarChar(128)
  email        String?         @db.VarChar(255)
  displayName  String?         @map("display_name") @db.VarChar(255)
  createdAt    DateTime?       @default(now()) @map("created_at") @db.Timestamp(6)

  // relations
  savingAccess SavingAccess[]
  savings      Savings[]

  @@map("users")
}

model Savings {
  uuid             String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name             String
  description      String
  userId           String         @map("userid")
  monthlyDeposited Int            @map("monthly_deposited")
  totalSaved       Int            @map("total_saved")
  countingDate     Int?           @map("counting_date")
  currency         String
  endDateSource    String

  // relations
  user             User           @relation(fields: [userId], references: [firebaseUid])
  savingAccess     SavingAccess[]

  @@map("savings")
}

model SavingAccess {
  id         Int      @id @default(autoincrement())
  savingUuid String   @map("savinguuid") @db.Uuid
  userId     String   @map("userid")
  editor     Boolean? @default(true)
  owner      Boolean? @default(true)
  isSelected Boolean? @map("isselected") @default(false)

  // relations
  savings    Savings  @relation(fields: [savingUuid], references: [uuid])
  user       User     @relation(fields: [userId], references: [firebaseUid])

  @@unique([savingUuid, userId]) // composite unique
  @@map("saving_access")
}

model items {
  itemId   String   @id @map("item_id") @db.Uuid
  savingId String   @map("saving_id") @db.Uuid
  itemName String?  @map("item_name") @db.VarChar(255)
  link     String?
  price    Decimal
  endDate  DateTime @map("end_date") @db.Date
  saved    Decimal
  priority Decimal
  locked   Boolean?
}


model contributionHistory {
  primaryId    Int      @id @default(autoincrement()) @map("primaryId")
  savingId     String   // odstrániť @map, lebo DB stĺpec sa volá presne takto
  date         DateTime @map("date") @db.Date
  currentValue Int      @map("currentValue")
  exchangeRate Decimal? @map("exchangerate") 
  currency     String?  @map("currency")

  @@map("contributionHistory")
}




